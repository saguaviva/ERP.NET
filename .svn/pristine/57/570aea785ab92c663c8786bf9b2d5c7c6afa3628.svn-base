Imports CoreLab.MySql
Public Class clsDetalleColoresModelo
    Inherits clsADO

#Region "CAMPOS"

    '+-----------+-------------+------+-----+---------+-------+
    '| Field     | Type        | Null | Key | Default | Extra |
    '+-----------+-------------+------+-----+---------+-------+
    '| CENTRO    | char(1)     | NO   | PRI | C       |       |
    '| MODEL     | varchar(10) | NO   | PRI |         |       |
    '| SERIE     | varchar(10) | NO   | PRI |         |       |
    '| TEMPORADA | varchar(15) | NO   | PRI |         |       |
    '| CLIENT    | int(11)     | NO   | PRI | 0       |       |
    '| MODCOL    | varchar(10) | NO   | PRI |         |       |
    '| TITULO    | varchar(25) | NO   | PRI |         |       |
    '| COLTITULO | varchar(15) | YES  |     | NULL    |       |
    '+-----------+-------------+------+-----+---------+-------+
    '8 rows

    Private mMODEL As String
    Public Property MODEL() As String
        Get
            If PA = -1 Then Exit Property
            Try
                mMODEL = nz(dvForm(pa).Row("MODEL"), "")
            Catch ex As Exception : End Try
            Return nz(mMODEL, "")
        End Get
        Set(ByVal Value As String)
            If PA = -1 Then Exit Property
            If nz(Value, "") <> nz(MODEL, "") Then
                mMODEL = nz(Value, "")
                dvForm(pa).Row("MODEL") = nz(mMODEL, "") : GuardarDV()
            End If
        End Set
    End Property

    Private mSERIE As String
    Public Property SERIE() As String
        Get
            If PA = -1 Then Exit Property
            Try
                mSERIE = nz(dvForm(pa).Row("SERIE"), "")
            Catch ex As Exception : End Try
            Return nz(mSERIE, "")
        End Get
        Set(ByVal Value As String)
            If PA = -1 Then Exit Property
            If nz(Value, "") <> nz(SERIE, "") Then
                mSERIE = nz(Value, "")
                dvForm(pa).Row("SERIE") = nz(mSERIE, "") : GuardarDV()
            End If
        End Set
    End Property

    Private mTEMPORADA As String
    Public Property TEMPORADA() As String
        Get
            If PA = -1 Then Exit Property
            Try
                mTEMPORADA = nz(dvForm(pa).Row("TEMPORADA"), "")
            Catch ex As Exception : End Try
            Return nz(mTEMPORADA, "")
        End Get
        Set(ByVal Value As String)
            If PA = -1 Then Exit Property
            If nz(Value, "") <> nz(TEMPORADA, "") Then
                mTEMPORADA = nz(Value, "")
                dvForm(pa).Row("TEMPORADA") = nz(mTEMPORADA, "") : GuardarDV()
            End If
        End Set
    End Property

    Private mCLIENT As Integer
    Public Property CLIENT() As Integer
        Get
            If PA = -1 Then Exit Property
            Try
                mCLIENT = nzn(dvForm(pa).Row("CLIENT"), 0)
            Catch ex As Exception : End Try
            Return nzn(mCLIENT, 0)
        End Get
        Set(ByVal Value As Integer)
            If PA = -1 Then Exit Property
            If esCodigoExistente(dtCLIENTS, CCCLIENTS, Value) Then
                If nzn(Value, 0) <> 0 Then
                    mCLIENT = nzn(Value, 0)
                    dvForm(pa).Row("NOMCLIENT") = OBN(Value, dtCLIENTS, CNCLIENTS)
                    dvForm(pa).Row("CLIENT") = nzn(Value, 0) : GuardarDV()
                End If
            Else
                dvForm(pa).Row("CLIENT") = 0

                dvForm(pa).Row("NOMCLIENT") = "" : GuardarDV()
                MessageBox.Show(rm.GetString("NOEXISTECLIENTS"))
            End If
        End Set
    End Property

    Private mNOMCLIENT As String
    Public Property NOMCLIENT() As String
        Get
            If PA = -1 Then Exit Property
            Try
                mNOMCLIENT = nz(dvForm(pa).Row("NOMCLIENT"), "")
            Catch ex As Exception : End Try
            Return nz(mNOMCLIENT, "")
        End Get
        Set(ByVal Value As String)
            If PA = -1 Then Exit Property
            mNOMCLIENT = nz(Value, "")
            If tabla.GetChanges Is Nothing Then
                dvForm(pa).Row("NOMCLIENT") = nz(Value, "") : GuardarDV()
                tabla.AcceptChanges()
            Else
                dvForm(pa).Row("NOMCLIENT") = nz(Value, "") : GuardarDV()
            End If
        End Set
    End Property

    Private mMODCOL As String
    Public Property MODCOL() As String
        Get
            If PA = -1 Then Exit Property
            Try
                mMODCOL = nz(dvForm(pa).Row("MODCOL"), "")
            Catch ex As Exception : End Try
            Return nz(mMODCOL, "")
        End Get
        Set(ByVal Value As String)
            If PA = -1 Then Exit Property
            If nz(Value, "") <> nz(MODCOL, "") Then
                mMODCOL = nz(Value, "")
                dvForm(pa).Row("MODCOL") = nz(mMODCOL, "") : GuardarDV()
            End If
        End Set
    End Property

    Private mTITULO As String
    Public Property TITULO() As String
        Get
            If PA = -1 Then Exit Property
            Try
                mTITULO = nz(dvForm(pa).Row("TITULO"), "")
            Catch ex As Exception : End Try
            Return nz(mTITULO, "")
        End Get
        Set(ByVal Value As String)
            If PA = -1 Then Exit Property
            If nz(Value, "") <> nz(TITULO, "") Then
                mTITULO = nz(Value, "")
                dvForm(pa).Row("TITULO") = nz(mTITULO, "") : GuardarDV()
            End If
        End Set
    End Property

    Private mCOLTITULO As String
    Public Property COLTITULO() As String
        Get
            If PA = -1 Then Exit Property
            Try
                mCOLTITULO = nz(dvForm(pa).Row("COLTITULO"), "")
            Catch ex As Exception : End Try
            Return nz(mCOLTITULO, "")
        End Get
        Set(ByVal Value As String)
            If PA = -1 Then Exit Property
            If nz(Value, "") <> nz(COLTITULO, "") Then
                mCOLTITULO = nz(Value, "")
                dvForm(pa).Row("COLTITULO") = nz(mCOLTITULO, "") : GuardarDV()
            End If
        End Set
    End Property

#End Region

#Region "VARIABLES"

    Friend dtClients As New DataTable("CLIENTS")
    Public dtColoresDeTejidos As New DataTable
    Friend modelo As clsModelo

#End Region

#Region "INICIAR"

    Public Sub New(ByVal tabla As DataTable, _
                ByVal centro As String, ByRef bindingcontext As BindingContext, ByVal mode As clsModelo)

        MyBase.New(tabla, centro, bindingcontext)
        Dim sqlSel As String
        Try
            modelo = mode

            sqlSinWhere = "SELECT MODCOL.* FROM MODCOL "

            sqlSel = sqlSinWhere & " WHERE MODEL = """ & modelo.CODI & """ AND " & _
                            " TEMPORADA = """ & modelo.TEMPORADA & """ AND " & _
                            " SERIE = """ & modelo.SERIE & """ AND " & _
                            " CLIENT = """ & modelo.CLIENT & """ AND " & _
                            " CENTRO = """ & modelo.centro & """ "

            cmdSel.CommandText = sqlSel
            da.SelectCommand = cmdSel
            da.Fill(tabla)
            dvForm.Sort = "MODCOL"

            IniciardtColoresDeTejidos()
            'AñadirAtablaColumnasPiezas()
            PonerDefaults()

        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Sub
    Friend Sub CambioDetalle(ByVal centro As String, ByVal mode As clsModelo)
        Try
            Dim sqlSel As String
            modelo = mode
            Me.centro = centro
            sqlSel = sqlSinWhere & _
                            " WHERE MODEL = """ & modelo.CODI & """ AND " & _
                            " TEMPORADA = """ & modelo.TEMPORADA & """ AND " & _
                            " SERIE = """ & modelo.SERIE & """ AND " & _
                            " CLIENT = """ & modelo.CLIENT & """ AND " & _
                            " CENTRO = """ & modelo.centro & """ "

            cmdSel.CommandText = sqlSel
            dvForm.Sort = "MODCOL"
            da.SelectCommand = cmdSel
            tabla.Clear()
            da.Fill(tabla)

            PonerDefaults()

        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Sub
    Private Sub IniciardtColoresDeTejidos()
        Dim dcTEIXIT As New DataColumn("TEIXIT", GetType(String))
        dcTEIXIT.Caption = rm.GetString("TEJIDO")
        Dim dcCOLOR As New DataColumn("COLOR", GetType(String))
        dcCOLOR.Caption = rm.GetString("COLOR")
        Dim dcPREU As New DataColumn("PREU", GetType(Double))
        dcPREU.Caption = rm.GetString("PRECIO")
        Try
            dtColoresDeTejidos.Columns.Add(dcTEIXIT)
            dtColoresDeTejidos.Columns.Add(dcCOLOR)
            dtColoresDeTejidos.Columns.Add(dcPREU)
            CargarColoresElegibles()

        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Sub
    Private Sub PonerDefaults()
        Try
            With dvForm
                .Table.Columns("MODEL").DefaultValue = modelo.CODI
                .Table.Columns("CLIENT").DefaultValue = modelo.CLIENT
                .Table.Columns("SERIE").DefaultValue = modelo.SERIE
                .Table.Columns("TEMPORADA").DefaultValue = modelo.TEMPORADA
                .Table.Columns("CENTRO").DefaultValue = modelo.centro
                .Table.Columns("MODCOL").DefaultValue = ""
                .Table.Columns("COLTITULO").DefaultValue = ""
                .Table.Columns("TITULO").DefaultValue = ""
            End With

        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Sub

    Public Sub CargarColoresElegibles()

        Dim strSQL As String
        Dim cmdSelect As New MySqlCommand
        Dim daReader As MySqlDataReader
        Dim dr As DataRow
        Try
            If Not ORSDETejidos() = "" Then

                cmdSelect.Connection = cnn
                strSQL = "SELECT " & _
                            " FIL AS TEIXIT, " & _
                            " TEIXITS.PREUPERMODEL AS PREU, " & _
                            " COLOR " & _
                            " FROM " & tablaHiloColores & " LEFT JOIN TEIXITS ON (TEIXITS.CODI = FILCOL.FIL AND TEIXITS.CENTRO = FILCOL.CENTRO) " & _
                            " WHERE " & tablaHiloColores & ".CENTRO  = """ & modelo.centro & """ AND TIPUS =""T"" " & _
                            " " & ORSDETejidos() & " " & _
                            " ORDER BY TEIXIT, COLOR"

                cmdSelect.CommandText = strSQL
                ACN()

                daReader = cmdSelect.ExecuteReader
                dtColoresDeTejidos.Clear()
                While daReader.Read
                    dr = dtColoresDeTejidos.NewRow
                    dr("TEIXIT") = daReader("TEIXIT")
                    dr("COLOR") = daReader("COLOR")
                    dr("PREU") = daReader("PREU")
                    dtColoresDeTejidos.Rows.Add(dr)
                End While
                daReader.Close()
            End If

        Catch ex As Exception
            LOG(ex.ToString) : cargando = False
            daReader.Close()
            CCN()
        End Try

    End Sub
    Private Function ORSDETejidos() As String
        Dim i As Integer
        Dim s As String
        Try
            For i = 0 To modelo.detalleEscandallo.dvForm.Count - 1
                If i = 0 Then
                    s = s & " AND ("
                End If
                s = s & " FIL = """ & NS(modelo.detalleEscandallo.dvForm(i).Item("TEIXIT")) & """ OR "
            Next
            If i = 0 Then
                Return ""
            Else
                Return s.Substring(0, s.Length - 3) & ")"
            End If

        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Function

#End Region

#Region "MODIFICACION PIEZA"

    Public Function tienePieza(ByVal pieza As String) As Boolean
        Dim s As String
        Try
            s = dvForm.Sort
            dvForm.Sort = "TITULO"
            If dvForm.Find(pieza) < 0 Then
                dvForm.Sort = s
                Return False
            Else
                dvForm.Sort = s
                Return True
            End If

        Catch ex As Exception
            LOG(ex.ToString)
        End Try
    End Function
    Public Function tieneColor(ByVal color As String) As Boolean
        Dim s As String
        Try
            s = dvForm.Sort
            dvForm.Sort = "MODCOL"
            If dvForm.Find(color) < 0 Then
                dvForm.Sort = s
                Return False
            Else
                dvForm.Sort = s
                Return True
            End If

        Catch ex As Exception
            LOG(ex.ToString)
        End Try
    End Function
    Public Sub ModificaPieza(ByVal piezaAntigua As String, ByVal piezaNueva As String)
        Dim i As Integer
        Dim aColores As New ArrayList
        Dim dr As DataRow
        Try
            If Not tienePieza(piezaAntigua) Then
                'MessageBox.Show("error")
            Else
                ModificarDeDVPorPieza(piezaAntigua, piezaNueva)
            End If

        Catch ex As Exception
            LOG(ex.ToString)
        End Try
    End Sub
    Public Sub AñadirPieza(ByVal pieza As String)
        Dim i As Integer
        Dim aColores As New ArrayList
        Dim dr As DataRow
        Try
            If Not tienePieza(pieza) Then
                For i = 0 To dvForm.Count - 1
                    If Not aColores.Contains(dvForm(i).Item("MODCOL")) Then
                        aColores.Add(dvForm(i).Item("MODCOL"))
                    End If
                Next
                For i = 0 To aColores.Count - 1
                    dr = tabla.NewRow
                    dr("CENTRO") = modelo.centro
                    dr("MODEL") = modelo.CODI
                    dr("SERIE") = modelo.SERIE
                    dr("TEMPORADA") = modelo.TEMPORADA
                    dr("CLIENT") = modelo.CLIENT
                    dr("MODCOL") = aColores(i)
                    dr("TITULO") = pieza
                    tabla.Rows.Add(dr)
                Next
            End If

        Catch ex As Exception
            LOG(ex.ToString)
        End Try
    End Sub
    Public Sub QuitarPieza(ByVal titulo As String)
        Try
            BorrarDeDVPorPieza(titulo)

        Catch ex As Exception
            LOG(ex.ToString)
        End Try
    End Sub
    Public Sub QuitarColor(ByVal color As String)
        Try
            If tieneColor(color) Then
                BorrarDeDVPorColor(color)
            End If

        Catch ex As Exception
            LOG(ex.ToString)
        End Try
    End Sub
    Public Sub añadirColor(ByVal color As String)
        Dim i As Integer
        Dim dr As DataRow
        Try
            If Not tieneColor(color) Then
                For i = 0 To modelo.detalleEscandallo.dvForm.Count - 1
                    dr = tabla.NewRow
                    dr("CENTRO") = modelo.centro
                    dr("MODEL") = modelo.CODI
                    dr("SERIE") = modelo.SERIE
                    dr("TEMPORADA") = modelo.TEMPORADA
                    dr("CLIENT") = modelo.CLIENT
                    dr("MODCOL") = color
                    dr("TITULO") = modelo.detalleEscandallo.dvForm(i).Item("TITULO")
                    tabla.Rows.Add(dr)
                Next
            End If

        Catch ex As Exception
            LOG(ex.ToString)
        End Try
    End Sub
    Private Sub ModificarDeDVPorPieza(ByVal piezaAntigua As String, ByVal piezaNueva As String)
        Dim i As Integer
        Dim dr1 As DataRow
        Dim tempRowFilter As String
        Try
            tempRowFilter = dvForm.RowFilter
            dvForm.RowFilter = "TITULO = '" & piezaAntigua & "'"
            Dim dr(dvForm.Count - 1) As DataRow
            For i = 0 To dvForm.Count - 1
                dr(i) = dvForm(i).Row
            Next
            dvForm.RowFilter = tempRowFilter
            Dim en As IEnumerator = dr.GetEnumerator
            While en.MoveNext
                en.Current("TITULO") = piezaNueva
            End While
            dvForm.RowFilter = tempRowFilter

        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Sub
    Private Sub BorrarDeDVPorColor(ByVal color As String)
        Dim i As Integer
        Dim dr1 As DataRow
        Dim tempRowFilter As String
        Try
            tempRowFilter = dvForm.RowFilter
            dvForm.RowFilter = "MODCOL = '" & color & "'"
            Dim dr(dvForm.Count - 1) As DataRow
            For i = 0 To dvForm.Count - 1
                dr(i) = dvForm(i).Row
            Next
            For Each dr1 In dr
                dr1.Delete()
            Next
            dvForm.RowFilter = tempRowFilter
            'ActualizarOrigen()

        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Sub
    Private Sub BorrarDeDVPorPieza(ByVal pieza As String)
        Dim i As Integer
        Dim dr1 As DataRow
        Dim tempRowFilter As String
        Try
            tempRowFilter = dvForm.RowFilter
            dvForm.RowFilter = "TITULO = '" & pieza & "'"
            Dim dr(dvForm.Count - 1) As DataRow
            For i = 0 To dvForm.Count - 1
                dr(i) = dvForm(i).Row
            Next
            For Each dr1 In dr
                dr1.Delete()
            Next
            dvForm.RowFilter = tempRowFilter
            'ActualizarOrigen()

        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Sub

#End Region

#Region "OVERRIDES"

    Friend Overrides Function TieneCambios() As Boolean
        Try
            guardarDV()
            If Not tabla.GetChanges Is Nothing Then
                Return True
            Else
                Return False
            End If

        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Function
    Friend Overrides Function genWhere() As String
        Try
            Dim ret As String

            ret = "WHERE " & tabla.TableName & ".CENTRO = """ & centro & """"

            Return ret
        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Function
    Friend Overrides Function GenOrder() As String
        Try
            Return ""
            'Return " ORDER BY TEMPORADA, CLIENT, SERIE, CODI "
        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Function
    Friend Overrides Function ObtenerNumeroRegistro(ByVal id As Object) As Integer
        If id Is Nothing Then
            id = MODEL
        End If

        Dim cmd As New MySqlCommand(" SELECT " & _
           " (SELECT COUNT(*) " & _
           " FROM " & tabla.TableName & " AS M2 WHERE " & _
           " M2.CODI < M1.CODI AND  " & WCNoTabla() & " ) AS rownum FROM " & tabla.TableName & " AS M1  WHERE CODI = """ & id & """ AND " & WCNoTabla() & GenOrder(), cnn)
        Try
            Dim idx As Object = cmd.ExecuteScalar()

            If idx Is Nothing Then Return -1
            Return idx '- 1

        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Function
    Friend Overrides Function genWhereNumeroRegistros() As String
        Try
            Return genWhere()
        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Function
    Public Overrides Sub borrar()
        Try
            'Este borra todas las lineas
            BorrarActualDVDetalle()

        Catch ex As Exception
            LOG(ex.ToString) : cargando = False : CCN()
        End Try
    End Sub

#End Region

    Friend Sub TratarFilaEscandallo()
        Dim i As Integer
        Try
            modelo.DormirHandlers()
            'dvForm.Sort = "TITULO"
            i = dvForm.Find(modelo.detalleEscandallo.TITULO)
            If i < 0 Then

                'Hay que añadir/modificar el titulo
                If modelo.detalleEscandallo.dvForm.RowStateFilter = DataViewRowState.ModifiedCurrent Then
                    MessageBox.Show("modificada")
                End If
                If modelo.detalleEscandallo.dvForm.RowStateFilter = DataViewRowState.Added Then
                    MessageBox.Show("nueva")
                End If

            End If
            modelo.DespertarHandlers()
        Catch ex As Exception
            LOG(ex.ToString)
        End Try
    End Sub
    Public Sub ActualizarDetalle()
        Dim i As Integer
        Dim cambio As Boolean = False
        Try
            For i = 0 To dvForm.Count - 1
                If nz(dvForm(i).Item("MODEL"), "") <> nz(modelo.CODI, 0) Then dvForm(i).Item("MODEL") = nz(modelo.CODI, 0) : cambio = True
                If nz(dvForm(i).Item("SERIE"), "") <> nz(modelo.SERIE, "") Then dvForm(i).Item("SERIE") = nz(modelo.SERIE, "") : cambio = True
                If nz(dvForm(i).Item("TEMPORADA"), "") <> nz(modelo.TEMPORADA, "") Then dvForm(i).Item("TEMPORADA") = nz(modelo.TEMPORADA, "") : cambio = True
                If nz(dvForm(i).Item("CENTRO"), "") <> nz(modelo.centro, "") Then dvForm(i).Item("CENTRO") = nz(modelo.centro, "") : cambio = True
            Next
            If cambio Then guardarDV()

        Catch ex As Exception
            LOG(ex.ToString)
        End Try
    End Sub
    Public Overrides Sub ActualizarOrigen(Optional ByVal nocerrar As Boolean = False, Optional ByVal hackDetalle As Boolean = False)
        Try
            ActualizarDetalle()
            MyBase.ActualizarOrigen(True, True)

        Catch ex As Exception
            LOG(ex.ToString)
        End Try
    End Sub

End Class

'Public Sub AñadirAtablaColumnasPiezas()
'    Dim i As Integer
'    Try
'        For i = 0 To modelo.detalleEscandallo.dvForm.Count - 1
'            With modelo.detalleEscandallo.dvForm(i)
'                Try
'                    tabla.Columns.Add(New DataColumn(.Item("TITULO"), GetType(String)))
'                Catch ex As Exception
'                End Try
'            End With
'        Next
'        dvForm = tabla.DefaultView

'    Catch ex As Exception
'        LOG(ex.ToString) : cargando = False : CCN()
'    End Try
'End Sub
'Public Sub ModificarColores()
'    Dim i, j As Integer
'    Dim aColores As New ArrayList
'    Dim aColoresPiezas As New ArrayList
'    Dim aPiezasEnColores As New ArrayList
'    Dim aPiezasEnEscandallo As New ArrayList
'    Dim dr As DataRow
'    Dim key(6) As Object
'    Try
'        modelo.DormirHandlers()


'        If modelo.detalleEscandallo.dvForm.Count = 0 Then : tabla.Clear() : Else

'            'En este caso hay un escandallo con partes de la prenda
'            For i = 0 To modelo.detalleEscandallo.dvForm.Count - 1
'                aPiezasEnEscandallo.Add(modelo.detalleEscandallo.dvForm(i).Item("TITULO"))
'            Next

'            For i = 0 To dvForm.Count - 1
'                If Not aColores.Contains(dvForm(i).Item("MODCOL")) Then
'                    aColores.Add(dvForm(i).Item("MODCOL"))
'                End If
'                If Not aPiezasEnColores.Contains(dvForm(i).Item("TITULO")) Then
'                    If Not IsDBNull(dvForm(i).Item("TITULO")) Then
'                        aPiezasEnColores.Add(dvForm(i).Item("TITULO"))
'                        aColoresPiezas.Add(nz(dvForm(i).Item("COLTITULO"), ""))
'                    End If
'                End If
'            Next

'            'Todos los que esten en aPiezasEncolores y no en aPiezasEnEscandallo borrar los de aPiezas
'            For i = 0 To aPiezasEnColores.Count - 1
'                If Not aPiezasEnEscandallo.Contains(aPiezasEnColores(i)) Then
'                    'Hay que borrar el aPiezasEnColores de dvform
'                    BorrarDeDV(aPiezasEnColores(i))
'                End If
'            Next

'            'Todos los que esten en aPiezasEnEscandallo y no esten en aPiezasEnColores añadirlo a aPiezasEnColores

'            For j = 0 To aColores.Count - 1
'                'Para cada color hay que introducir un titulo de estos
'                For i = 0 To aPiezasEnEscandallo.Count - 1
'                    dr = tabla.NewRow

'                    dr("CENTRO") = modelo.centro
'                    key(0) = modelo.centro
'                    dr("MODEL") = modelo.CODI
'                    key(1) = modelo.CODI
'                    dr("SERIE") = modelo.SERIE
'                    key(2) = modelo.SERIE
'                    dr("TEMPORADA") = modelo.TEMPORADA
'                    key(3) = modelo.TEMPORADA
'                    dr("CLIENT") = modelo.CLIENT
'                    key(4) = modelo.CLIENT
'                    dr("MODCOL") = aColores(j)
'                    key(5) = aColores(j)
'                    dr("TITULO") = aPiezasEnEscandallo(i)
'                    key(6) = aPiezasEnEscandallo(i)

'                    Try
'                        dr("COLTITULO") = nz(aColoresPiezas(i), "")
'                    Catch ex As Exception
'                        'Puede ser que sea uno nuevo no tiene todavia aColoresPiezas :) Fallo chorra
'                        'LOG(ex.ToString)
'                    End Try

'                    If Not tabla.Rows.Contains(key) Then
'                        tabla.Rows.Add(dr)
'                    End If
'                Next
'            Next
'        End If
'        Me.ActualizarOrigen(True, True)
'        modelo.DespertarHandlers()

'    Catch ex As Exception
'        LOG(ex.ToString) : cargando = False : CCN()
'    End Try
'End Sub

'Private Sub BorrarDeDV(ByVal tit As String)
'    Dim i As Integer
'    Dim dr1 As DataRow
'    Dim tempRowFilter As String
'    Try
'        tempRowFilter = dvForm.RowFilter
'        dvForm.RowFilter = "TITULO = '" & tit & "'"
'        Dim dr(dvForm.Count - 1) As DataRow
'        For i = 0 To dvForm.Count - 1
'            dr(i) = dvForm(i).Row
'        Next
'        For Each dr1 In dr
'            dr1.Delete()
'        Next
'        dvForm.RowFilter = tempRowFilter
'        'ActualizarOrigen()

'    Catch ex As Exception
'        LOG(ex.ToString) : cargando = False : CCN()
'    End Try
'End Sub
